STEP SIZE - FUNCTIONAL BLOCKS: Step = completed functional block with verifiable result. NOT too small (not just create a file), NOT too large (not implement entire frontend). Correct: Database layer with user isolation, MCP integration with authentication, Web UI for workflow management. Workflow has gate validation after each step - expensive in time. Too small steps = dozens of checks instead of 3-5. Too large steps = agent gets lost. ARCHITECTURE AT PLAN START: MANDATORY Architecture section after Goal. Describes: overall solution architecture, key components and interaction, architectural decisions (technologies, approaches), diagrams if applicable (ASCII, Mermaid, text description). Not too much needed - conceptual understanding is enough. Plan undergoes mandatory validation where user confirms architecture. FORBIDDEN IN PLAN - SPECIFIC FILES AND CODE: Specific paths, functions/methods, line numbers, code examples (TypeScript interfaces, SQL, React), Files Created/Modified lists. Correct: Implement authentication layer, Update database schema for user isolation, Create UI components. REASON: Agents blindly follow the plan. Plan with files creates false sense of completeness - agent forgets critical details. Agent must ITSELF analyze code and find where to implement. WHAT TO WRITE: functionality and behavior, integration points conceptually, expected result, verification criteria. TESTING BUILT-IN - NOT SEPARATE: Separate steps Write tests, Validation, Check are FORBIDDEN. Each step includes implementation + tests + self-check. Description states including unit tests, including browser testing for UI. Workflow automatically performs gate validation. REASON: Tests are integral part of development. Separate testing step = agent writes code without tests, then adds afterward - wrong. PLAN FORMAT: Structure: # Title → ## Goal (one sentence) → ## Architecture (components, decisions, diagrams) → ## Step 1-N (functionality, integration points, what will work). FORBIDDEN sections: Overview, Summary, Acceptance Criteria, Validation blocks with bash, Files Created/Modified, UPDATED REQUIREMENTS. VOLUME: Simple 50-100 lines (3-4 steps), Medium 100-200 lines (5-7 steps), Complex 200-300 lines (8-12 steps). If >400 lines - you are writing code instead of plan. PLAN FOR REVIEWER WITHOUT CONTEXT: Plan must be written IN SUCH DETAIL that reviewer WITHOUT work context and conversation history can fully understand and verify all work. BUT: Detail ≠ code and files. Detail = clear description of FUNCTIONALITY and RESULT. Reviewer runs WITHOUT CONTEXT - architectural system decision. STEP FEASIBILITY: Each step - absolutely executable by agent, maximally specific in functionality, with clear completion criterion. HUGE STEP = RED FLAG of task misunderstanding. Actions: STOP → study project in detail → ask user → web search → delegate analysis to agent. LARGE STEP = PLANNING FAILURE. GRADUAL BUILDUP: 1) Base layer (data models, core logic, services) + unit tests 2) Integration layer (API endpoints, MCP tools) + integration tests 3) UI layer (Web interface, forms) + browser tests (Playwright). FROM CORE TO INTERFACE. USER APPROVAL STEPS: Some steps require confirmation: UI changes, Breaking changes, Architectural decisions, API changes. Specify in plan: [USER APPROVAL] before continuing. CLEANUP STEP: If code/junk cleanup required - separate final step Code cleanup and final check. DO NOT mix with functional steps. NO SUBITEMS: plan must be simple list of steps without subitems like 5.1, 5.2 - only whole steps 1, 2, 3, 4. Subitems = sign that step is too large. PLAN WITH CHECKS: Each step contains: WHAT will change (functionality, not files), WHICH functionality to check, HOW to check (conceptually). NO bash commands, SQL queries, specific test cases needed. Enough: After step user authentication works, MCP tools use authenticated context, UI displays user workflows. PLANNING PRINCIPLES: CODE RESEARCH for patterns, WEB RESEARCH for best practices, LIBRARY DOCUMENTATION, DO NOT ASSUME - only facts, CURRENT library VERSIONS. Good plan = result of deep analysis, not guess. FORMULA: Plan = Architecture + Functional blocks (3-12 steps) + Verification criteria. WITHOUT: code, files, validation blocks, subitems. Good plan reads in 2 minutes and gives complete understanding.
